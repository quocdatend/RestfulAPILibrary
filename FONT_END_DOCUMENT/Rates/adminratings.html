<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý đánh giá</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto p-4 md:p-8 max-w-4xl">
    <header class="bg-white p-6 rounded-lg shadow-md mb-6">
      <h1 class="text-3xl font-bold text-gray-800">Quản lý Đánh giá</h1>
      <p class="text-gray-600 mt-2">Thêm và quản lý đánh giá của khách hàng</p>
    </header>
    <!-- Form Thêm Đánh giá -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h2 class="text-xl font-semibold mb-4 text-gray-700">Thêm đánh giá mới</h2>
      <form id="rating-form" class="space-y-4">
        <div class="flex flex-col md:flex-row gap-4">
          <div class="w-full md:w-1/4">
            <label for="rating" class="block text-sm font-medium text-gray-700 mb-1">Điểm đánh giá</label>
            <div class="flex items-center">
              <select id="rating" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="" disabled selected>Chọn điểm</option>
                <option value="1">1 - Rất tệ</option>
                <option value="2">2 - Tệ</option>
                <option value="3">3 - Bình thường</option>
                <option value="4">4 - Tốt</option>
                <option value="5">5 - Xuất sắc</option>
              </select>
            </div>
          </div>
          <div class="w-full md:w-3/4">
            <label for="review" class="block text-sm font-medium text-gray-700 mb-1">Nhận xét</label>
            <textarea id="review" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-16" placeholder="Nhập nhận xét của bạn" rows="2" required></textarea>
          </div>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition duration-200 flex items-center">
            <i class="fas fa-plus mr-2"></i> Thêm Đánh Giá
          </button>
        </div>
      </form>
    </div>
    
    <!-- Thống kê đánh giá -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h2 class="text-xl font-semibold mb-4 text-gray-700">Tổng quan đánh giá</h2>
      <div class="flex flex-wrap justify-around gap-4">
        <div class="text-center p-4">
          <div id="avg-rating" class="text-4xl font-bold text-blue-600">0</div>
          <div class="text-sm text-gray-600">Điểm trung bình</div>
        </div>
        <div class="text-center p-4">
          <div id="total-ratings" class="text-4xl font-bold text-green-600">0</div>
          <div class="text-sm text-gray-600">Tổng số đánh giá</div>
        </div>
        <div class="text-center p-4">
          <div id="five-star-ratings" class="text-4xl font-bold text-yellow-500">0</div>
          <div class="text-sm text-gray-600">Đánh giá 5 sao</div>
        </div>
      </div>
    </div>
    
    <!-- Danh sách đánh giá -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-gray-700">Danh sách đánh giá</h2>
        <div class="flex items-center">
          <label for="sort-by" class="mr-2 text-sm text-gray-600">Sắp xếp:</label>
          <select id="sort-by" class="p-2 border border-gray-300 rounded-lg text-sm">
            <option value="newest">Mới nhất</option>
            <option value="oldest">Cũ nhất</option>
            <option value="highest">Điểm cao nhất</option>
            <option value="lowest">Điểm thấp nhất</option>
          </select>
        </div>
      </div>
      
      <div id="ratings-list" class="space-y-4">
        <!-- Đánh giá sẽ được hiển thị tại đây -->
        <div class="text-center text-gray-500 py-8">
          <i class="fas fa-spinner fa-spin text-4xl mb-3"></i>
          <p>Đang tải dữ liệu...</p>
        </div>
      </div>
      
      <div id="empty-state" class="hidden text-center py-10">
        <i class="fas fa-comment-slash text-5xl text-gray-400 mb-3"></i>
        <p class="text-gray-500">Chưa có đánh giá nào</p>
        <p class="text-gray-400 text-sm mt-2">Thêm đánh giá mới để hiển thị tại đây</p>
      </div>
    </div>
  </div>

  <!-- Modal xác nhận xóa -->
  <div id="delete-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
      <h3 class="text-xl font-bold mb-4">Xác nhận xóa</h3>
      <p class="mb-6">Bạn có chắc chắn muốn xóa đánh giá này không? Hành động này không thể hoàn tác.</p>
      <div class="flex justify-end space-x-3">
        <button id="cancel-delete" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Hủy</button>
        <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Xóa</button>
      </div>
    </div>
  </div>

  <script>
    const ratingForm = document.getElementById('rating-form');
    const ratingsList = document.getElementById('ratings-list');
    const emptyState = document.getElementById('empty-state');
    const deleteModal = document.getElementById('delete-modal');
    const cancelDelete = document.getElementById('cancel-delete');
    const confirmDelete = document.getElementById('confirm-delete');
    const sortBy = document.getElementById('sort-by');
    
    let ratings = [];
    let currentDeleteId = null;

    // Render các ngôi sao dựa vào điểm
    const renderStars = (rating) => {
      let starsHtml = '';
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
          starsHtml += '<i class="fas fa-star text-yellow-400"></i>';
        } else {
          starsHtml += '<i class="far fa-star text-gray-300"></i>';
        }
      }
      return starsHtml;
    };

    // Format ngày giờ
    const formatDate = (dateString) => {
      const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      return new Date(dateString).toLocaleDateString('vi-VN', options);
    };

    // Cập nhật thống kê
    const updateStats = () => {
      const totalRatings = ratings.length;
      const fiveStarRatings = ratings.filter(r => r.rating == 5).length;
      let avgRating = 0;
      
      if (totalRatings > 0) {
        const sum = ratings.reduce((acc, curr) => acc + parseInt(curr.rating), 0);
        avgRating = (sum / totalRatings).toFixed(1);
      }
      
      document.getElementById('avg-rating').textContent = avgRating;
      document.getElementById('total-ratings').textContent = totalRatings;
      document.getElementById('five-star-ratings').textContent = fiveStarRatings;
    };

    // Sắp xếp đánh giá
    const sortRatings = (sortType) => {
      switch (sortType) {
        case 'newest':
          return [...ratings].sort((a, b) => new Date(b.createdAt || Date.now()) - new Date(a.createdAt || Date.now()));
        case 'oldest':
          return [...ratings].sort((a, b) => new Date(a.createdAt || Date.now()) - new Date(b.createdAt || Date.now()));
        case 'highest':
          return [...ratings].sort((a, b) => b.rating - a.rating);
        case 'lowest':
          return [...ratings].sort((a, b) => a.rating - b.rating);
        default:
          return ratings;
      }
    };

    // Hiển thị danh sách đánh giá
    const displayRatings = () => {
      const sortedRatings = sortRatings(sortBy.value);
      
      if (sortedRatings.length === 0) {
        ratingsList.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      ratingsList.innerHTML = '';
      
      sortedRatings.forEach(rating => {
        const ratingDiv = document.createElement('div');
        ratingDiv.classList.add('bg-gray-50', 'p-4', 'rounded-lg', 'border', 'border-gray-200');
        ratingDiv.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <div class="mb-2">${renderStars(rating.rating)}</div>
              <p class="text-gray-700 mb-2">${rating.review}</p>
              <p class="text-xs text-gray-500">${formatDate(rating.createdAt || new Date())}</p>
            </div>
            <button onclick="showDeleteModal('${rating._id}')" class="text-gray-400 hover:text-red-500">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        `;
        ratingsList.appendChild(ratingDiv);
      });
    };

    // Hiển thị modal xác nhận xóa
    window.showDeleteModal = (id) => {
      currentDeleteId = id;
      deleteModal.classList.remove('hidden');
    };

    // Ẩn modal xác nhận xóa
    const hideDeleteModal = () => {
      deleteModal.classList.add('hidden');
      currentDeleteId = null;
    };

    // Thêm đánh giá
    ratingForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      
      const rating = document.getElementById('rating').value;
      const review = document.getElementById('review').value;
      
      try {
        // Giả lập thêm đánh giá
        const newRating = {
          _id: 'rating_' + Date.now(),
          rating: parseInt(rating),
          review,
          createdAt: new Date()
        };
        
        // Thêm vào đầu mảng
        ratings.unshift(newRating);
        
        // Reset form
        ratingForm.reset();
        
        // Cập nhật UI
        updateStats();
        displayRatings();
        
        // Thông báo thành công
        alert('Thêm đánh giá thành công!');
      } catch (error) {
        alert('Lỗi khi thêm đánh giá: ' + error.message);
      }
    });

    // Xóa đánh giá
    const deleteRating = (id) => {
      // Tìm và xóa đánh giá khỏi mảng
      ratings = ratings.filter(rating => rating._id !== id);
      
      // Cập nhật UI
      updateStats();
      displayRatings();
      
      // Ẩn modal
      hideDeleteModal();
      
      // Thông báo thành công
      alert('Xóa đánh giá thành công!');
    };

    // Sự kiện cho nút hủy xóa
    cancelDelete.addEventListener('click', hideDeleteModal);
    
    // Sự kiện cho nút xác nhận xóa
    confirmDelete.addEventListener('click', () => {
      if (currentDeleteId) {
        deleteRating(currentDeleteId);
      }
    });
    
    // Sự kiện khi thay đổi cách sắp xếp
    sortBy.addEventListener('change', displayRatings);

    // Giả lập tải dữ liệu
    const loadRatings = () => {
      // Đây là dữ liệu mẫu, thay bằng fetch API trong thực tế
      setTimeout(() => {
        ratings = [
          {
            _id: 'rating1',
            rating: 5,
            review: 'Sản phẩm rất tuyệt vời, đúng như mô tả và giao hàng nhanh chóng!',
            createdAt: '2025-04-09T10:30:00Z'
          },
          {
            _id: 'rating2',
            rating: 4,
            review: 'Chất lượng tốt, nhưng đóng gói có thể cải thiện thêm.',
            createdAt: '2025-04-08T15:45:00Z'
          },
          {
            _id: 'rating3',
            rating: 3,
            review: 'Bình thường, không có gì đặc biệt.',
            createdAt: '2025-04-07T09:15:00Z'
          }
        ];
        
        updateStats();
        displayRatings();
      }, 1000);
    };

    // Tải dữ liệu khi trang được tải
    loadRatings();
  </script>
</body>
</html>