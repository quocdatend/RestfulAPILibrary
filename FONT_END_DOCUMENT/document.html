<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem Tài Liệu - Thư Viện Tài Liệu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-color: #333;
            --text-light: #7f8c8d;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* Layout chính */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background-color: var(--dark-color);
            color: white;
            padding: 0.8rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Nội dung chính */
        .main-content {
            flex: 1;
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Trình xem PDF */
        .pdf-viewer-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 150px);
            background-color: #525659; /* Màu nền giống Adobe Reader */
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .pdf-toolbar {
            background-color: var(--dark-color);
            color: white;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pdf-canvas-container {
            flex: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
        }

        #pdf-viewer-canvas {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            background-color: white;
        }

        .page-navigation {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        /* Thông tin tài liệu */
        .document-sidebar {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 1.5rem;
        }

        .document-title {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .document-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .meta-item i {
            color: var(--primary-color);
        }

        .document-description {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .rating-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .rating-stars {
            color: var(--warning-color);
        }

        /* Các nút điều khiển */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Responsive */
        @media (min-width: 992px) {
            .document-layout {
                display: grid;
                grid-template-columns: 1fr 300px;
                gap: 1.5rem;
            }
            
            .pdf-viewer-container {
                height: calc(100vh - 120px);
            }
            
            .document-sidebar {
                margin-top: 0;
                height: calc(100vh - 120px);
                overflow-y: auto;
                position: sticky;
                top: 80px;
            }
        }

        @media (max-width: 768px) {
            .pdf-toolbar {
                flex-wrap: wrap;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            
            .toolbar-group {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="nav-container">
                <a href="index.html" class="logo">
                    <i class="fas fa-book-open"></i>
                    <span>Thư Viện Tài Liệu</span>
                </a>
                
                <div class="user-actions">
                    <button class="btn btn-primary" id="login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Đăng nhập</span>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Nội dung chính -->
        <main class="main-content">
            <div class="document-layout">
                <!-- Trình xem PDF -->
                <div class="pdf-viewer-container">
                    <div class="pdf-toolbar">
                        <div class="toolbar-group">
                            <button class="btn-icon" id="zoom-out" title="Thu nhỏ">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <span id="zoom-level">100%</span>
                            <button class="btn-icon" id="zoom-in" title="Phóng to">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                        
                        <div class="toolbar-group">
                            <button class="btn-icon" id="prev-page" title="Trang trước">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <span id="page-num">Trang 1/1</span>
                            <button class="btn-icon" id="next-page" title="Trang sau">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        
                        <div class="toolbar-group">
                            <button class="btn-icon" id="fit-width" title="Vừa chiều rộng">
                                <i class="fas fa-arrows-alt-h"></i>
                            </button>
                            <button class="btn-icon" id="fit-page" title="Vừa trang">
                                <i class="fas fa-arrows-alt-v"></i>
                            </button>
                            <button class="btn btn-primary btn-sm" id="download-pdf">
                                <i class="fas fa-download"></i> Tải xuống
                            </button>
                        </div>
                    </div>
                    
                    <div class="pdf-canvas-container">
                        <canvas id="pdf-viewer-canvas"></canvas>
                    </div>
                     <!-- Thêm nút fullscreen vào toolbar -->
    <div class="pdf-toolbar">
        <!-- Các nút điều khiển khác -->
        <div class="toolbar-group">
            <button class="btn-icon" id="fullscreen-btn" title="Toàn màn hình">
                <i class="fas fa-expand"></i>
            </button>
            <!-- Các nút khác -->
        </div>
    </div>
                    
                    <div class="page-navigation">
                        <button class="btn-icon" id="prev-page-bottom">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <span id="page-num-bottom">Trang 1/1</span>
                        <button class="btn-icon" id="next-page-bottom">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Thông tin tài liệu -->
                <div class="document-sidebar">
                    <h1 class="document-title" id="document-name">Tên tài liệu</h1>
                    
                    <div class="document-meta">
                        <div class="meta-item">
                            <i class="fas fa-book"></i>
                            <span id="document-type">Loại tài liệu</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-download"></i>
                            <span id="document-downloads">Lượt tải</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span id="document-date">Ngày đăng</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-file-alt"></i>
                            <span id="document-pages">Số trang</span>
                        </div>
                    </div>
                    
                    <div class="rating-container">
                        <div class="rating-stars" id="document-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <span id="rating-score">4.0</span>
                    </div>
                    
                    <button class="btn btn-primary" id="rate-document" style="margin-top: 1rem; width: 100%;">
                        <i class="fas fa-star"></i> Đánh giá tài liệu
                    </button>
                    
                    <div class="document-description">
                        <h3>Mô tả tài liệu</h3>
                        <p id="document-description">Mô tả chi tiết về tài liệu sẽ hiển thị ở đây. Phần này cung cấp thông tin tổng quan về nội dung, mục đích và đối tượng phù hợp cho tài liệu.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        // Khởi tạo PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

        // Dữ liệu tài liệu
        const documentData = {
            url: './wiley-chapter.pdf',
            title: 'Toán cao cấp cho kỹ thuật',
            type: 'Giáo trình Đại học',
            downloads: '1,245 lượt',
            date: '15/10/2023',
            pages: '250 trang',
            rating: 4.5,
            description: 'Giáo trình Toán cao cấp dành cho sinh viên khối kỹ thuật. Bao gồm các chương: Đại số tuyến tính, Giải tích hàm một biến, Phương trình vi phân. Tài liệu cung cấp lý thuyết cơ bản kèm bài tập có lời giải chi tiết và đề thi mẫu.'
        };

        // Biến toàn cục
        let pdfDoc = null;
        let currentPage = 1;
        let currentScale = 1.0;
        let isFitWidth = false;
        const canvas = document.getElementById('pdf-viewer-canvas');
        const ctx = canvas.getContext('2d');

        // Khởi tạo trình xem
        function initPDFViewer() {
            loadDocumentInfo();
            loadPDFDocument();
            setupEventListeners();
        }

        // Hiển thị thông tin tài liệu
        function loadDocumentInfo() {
            document.getElementById('document-name').textContent = documentData.title;
            document.getElementById('document-type').textContent = documentData.type;
            document.getElementById('document-downloads').textContent = documentData.downloads;
            document.getElementById('document-date').textContent = documentData.date;
            document.getElementById('document-pages').textContent = documentData.pages;
            document.getElementById('document-description').textContent = documentData.description;
            document.getElementById('rating-score').textContent = documentData.rating;
            
            // Hiển thị rating
            const ratingContainer = document.getElementById('document-rating');
            ratingContainer.innerHTML = '';
            const rating = documentData.rating;
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    ratingContainer.innerHTML += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    ratingContainer.innerHTML += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    ratingContainer.innerHTML += '<i class="far fa-star"></i>';
                }
            }
        }

        // Tải tài liệu PDF
        function loadPDFDocument() {
            pdfjsLib.getDocument(documentData.url).promise.then(pdf => {
                pdfDoc = pdf;
                updatePageCount();
                renderPage(currentPage);
            }).catch(error => {
                console.error('Lỗi khi tải PDF:', error);
                alert('Không thể tải tài liệu. Vui lòng thử lại sau.');
            });
        }

        // Cập nhật số trang
        function updatePageCount() {
            const pageCount = pdfDoc.numPages;
            document.getElementById('page-num').textContent = `Trang ${currentPage}/${pageCount}`;
            document.getElementById('page-num-bottom').textContent = `Trang ${currentPage}/${pageCount}`;
        }

        // Hiển thị trang
        function renderPage(pageNum) {
            pdfDoc.getPage(pageNum).then(page => {
                const viewport = page.getViewport({ scale: currentScale });
                
                // Điều chỉnh kích thước canvas
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                // Render PDF
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                page.render(renderContext);
            });
        }

        // Tính toán scale vừa chiều rộng
        function calculateFitWidthScale(page) {
            const container = document.querySelector('.pdf-canvas-container');
            const containerWidth = container.clientWidth - 40; // Trừ padding
            const viewport = page.getViewport({ scale: 1.0 });
            return containerWidth / viewport.width;
        }

        // Tính toán scale vừa trang
        function calculateFitPageScale(page) {
            const container = document.querySelector('.pdf-canvas-container');
            const containerWidth = container.clientWidth - 40;
            const containerHeight = container.clientHeight - 40;
            const viewport = page.getViewport({ scale: 1.0 });
            
            const widthScale = containerWidth / viewport.width;
            const heightScale = containerHeight / viewport.height;
            
            return Math.min(widthScale, heightScale);
        }

        // Cập nhật zoom level
        function updateZoomLevel() {
            document.getElementById('zoom-level').textContent = `${Math.round(currentScale * 100)}%`;
        }

        // Thiết lập event listeners
        function setupEventListeners() {
            // Điều hướng trang
            document.getElementById('prev-page').addEventListener('click', goToPrevPage);
            document.getElementById('next-page').addEventListener('click', goToNextPage);
            document.getElementById('prev-page-bottom').addEventListener('click', goToPrevPage);
            document.getElementById('next-page-bottom').addEventListener('click', goToNextPage);
            
            // Zoom
            document.getElementById('zoom-in').addEventListener('click', () => {
                currentScale += 0.1;
                renderPage(currentPage);
                updateZoomLevel();
                isFitWidth = false;
            });
            
            document.getElementById('zoom-out').addEventListener('click', () => {
                if (currentScale > 0.2) {
                    currentScale -= 0.1;
                    renderPage(currentPage);
                    updateZoomLevel();
                    isFitWidth = false;
                }
            });
            
            // Fit modes
            document.getElementById('fit-width').addEventListener('click', fitToWidth);
            document.getElementById('fit-page').addEventListener('click', fitToPage);
            
            // Tải xuống
            document.getElementById('download-pdf').addEventListener('click', downloadPDF);
            
            // Đánh giá
            document.getElementById('rate-document').addEventListener('click', rateDocument);
            
            // Phím tắt
            document.addEventListener('keydown', handleKeyPress);
        }

        // Điều hướng trang
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
                updatePageCount();
                scrollToTop();
            }
        }

        function goToNextPage() {
            if (currentPage < pdfDoc.numPages) {
                currentPage++;
                renderPage(currentPage);
                updatePageCount();
                scrollToTop();
            }
        }

        // Cuộn lên đầu trang
        function scrollToTop() {
            document.querySelector('.pdf-canvas-container').scrollTo(0, 0);
        }

        // Chế độ hiển thị
        function fitToWidth() {
            pdfDoc.getPage(currentPage).then(page => {
                currentScale = calculateFitWidthScale(page);
                renderPage(currentPage);
                updateZoomLevel();
                isFitWidth = true;
            });
        }

        function fitToPage() {
            pdfDoc.getPage(currentPage).then(page => {
                currentScale = calculateFitPageScale(page);
                renderPage(currentPage);
                updateZoomLevel();
                isFitWidth = false;
            });
        }

        // Tải xuống PDF
        function downloadPDF() {
            const link = document.createElement('a');
            link.href = documentData.url;
            link.download = documentData.title.replace(/\s+/g, '_') + '.pdf';
            link.click();
        }

        // Đánh giá tài liệu
        function rateDocument() {
            alert('Chức năng đánh giá sẽ được triển khai trong phiên bản sau!');
        }

        // Xử lý phím tắt
        function handleKeyPress(e) {
            switch(e.key) {
                case 'ArrowLeft':
                    goToPrevPage();
                    break;
                case 'ArrowRight':
                    goToNextPage();
                    break;
                case '+':
                    currentScale += 0.1;
                    renderPage(currentPage);
                    updateZoomLevel();
                    break;
                case '-':
                    if (currentScale > 0.2) {
                        currentScale -= 0.1;
                        renderPage(currentPage);
                        updateZoomLevel();
                    }
                    break;
            }
        }
        let isFullscreen = false;
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const pdfViewerContainer = document.querySelector('.pdf-viewer-container');

        function toggleFullscreen() {
            isFullscreen = !isFullscreen;
            
            if (isFullscreen) {
                pdfViewerContainer.classList.add('full-container');
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                fullscreenBtn.title = 'Thoát toàn màn hình';
            } else {
                pdfViewerContainer.classList.remove('full-container');
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                fullscreenBtn.title = 'Toàn màn hình';
            }
            
            // Render lại trang với kích thước mới
            setTimeout(() => {
                if (isFitWidth) {
                    fitToWidth();
                } else {
                    renderPage(currentPage);
                }
            }, 100);
        }

        function renderPage(pageNum) {
            pdfDoc.getPage(pageNum).then(page => {
                let viewport;
                const container = document.querySelector('.pdf-canvas-container');
                
                if (isFitWidth) {
                    const containerWidth = container.clientWidth;
                    const tempViewport = page.getViewport({ scale: 1.0 });
                    const scale = containerWidth / tempViewport.width;
                    viewport = page.getViewport({ scale: scale });
                } else {
                    viewport = page.getViewport({ scale: currentScale });
                    
                    // Tự động điều chỉnh nếu vượt quá kích thước container
                    const containerWidth = container.clientWidth;
                    const containerHeight = container.clientHeight;
                    
                    if (viewport.width > containerWidth || viewport.height > containerHeight) {
                        const widthScale = containerWidth / viewport.width;
                        const heightScale = containerHeight / viewport.height;
                        const autoScale = Math.min(widthScale, heightScale);
                        viewport = page.getViewport({ scale: currentScale * autoScale });
                    }
                }
                
                // Điều chỉnh kích thước canvas
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                // Render PDF
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                page.render(renderContext);
            });
        }

        window.addEventListener('resize', () => {
            if (pdfDoc) {
                renderPage(currentPage);
            }
        });

       
        // Khởi tạo trình xem
        document.addEventListener('DOMContentLoaded', () => {
            initPDFViewer();
            setTimeout(fitToWidth, 500);
        });

        // Khởi chạy khi DOM sẵn sàng
        document.addEventListener('DOMContentLoaded', initPDFViewer);
    </script>
</body>
</html>